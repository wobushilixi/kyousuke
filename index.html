<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111111" media="(prefers-color-scheme: dark)">
    <title>iozz - 智能优选</title>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js'));
        }
    </script>

    <style>
        /* --- 现代设计系统 --- */
        :root {
            /* 浅色模式 */
            --bg: #ffffff;
            --surface: #f7f7f8; /* 极浅的灰，用于区分层次 */
            --fg-primary: #111111;
            --fg-secondary: #666666;
            --accent: #000000; /* 极致的黑作为强调色 */
            --accent-fg: #ffffff;
            --border: #eaeaea;
            --shadow: 0 4px 20px rgba(0,0,0,0.04);
            --radius: 16px;
            --font-sans: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
            --ease: cubic-bezier(0.16, 1, 0.3, 1); /* 丝滑缓动 */
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* 深色模式 */
                --bg: #0a0a0a; /* 不是纯黑，更护眼 */
                --surface: #1a1a1a;
                --fg-primary: #ffffff;
                --fg-secondary: #a1a1a1;
                --accent: #ffffff;
                --accent-fg: #000000;
                --border: #333333;
                --shadow: 0 4px 20px rgba(0,0,0,0.3);
            }
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: var(--font-sans);
            background: var(--bg);
            color: var(--fg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
            overflow: hidden; /* 防止滚动 */
        }

        /* --- 布局容器 --- */
        .app-container {
            width: 100%;
            max-width: 480px;
            padding: 40px 24px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            z-index: 2;
        }

        /* --- LOGO 区域 --- */
        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            animation: fadeIn 0.8s var(--ease) forwards;
        }

        .logo-img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: var(--shadow);
        }

        .brand-text {
            font-weight: 600;
            font-size: 16px;
            letter-spacing: -0.02em;
        }

        /* --- 核心倒计时 (Hero Section) --- */
        .hero-section {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            opacity: 0;
            animation: scaleIn 0.8s var(--ease) 0.1s forwards;
        }

        /* 巨大的数字 */
        .timer-display {
            font-size: 120px;
            font-weight: 800;
            line-height: 1;
            letter-spacing: -0.04em;
            font-variant-numeric: tabular-nums;
            position: relative;
            z-index: 1;
            background: linear-gradient(180deg, var(--fg-primary) 0%, var(--fg-secondary) 150%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 进度条 */
        .progress-bar-container {
            width: 60px;
            height: 4px;
            background: var(--surface);
            border-radius: 2px;
            margin-top: 24px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--fg-primary);
            width: 100%;
            transform-origin: left;
            transition: transform 1s linear;
        }

        /* --- 状态信息 --- */
        .status-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0;
            animation: slideUp 0.8s var(--ease) 0.2s forwards;
        }

        .status-label {
            font-size: 13px;
            color: var(--fg-secondary);
            font-weight: 500;
        }

        .target-name {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--surface);
            border-radius: 100px; /* 胶囊形状 */
            transition: all 0.3s var(--ease);
        }

        /* 脉冲点 */
        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981; /* Green */
        }
        .pulse-dot.loading { background: #f59e0b; animation: pulse 1s infinite; }
        .pulse-dot.error { background: #ef4444; }

        /* --- 操作按钮 --- */
        .actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 280px;
            opacity: 0;
            animation: slideUp 0.8s var(--ease) 0.3s forwards;
        }

        .btn {
            height: 52px;
            border-radius: 14px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn:active { transform: scale(0.96); }

        .btn-primary {
            background: var(--fg-primary);
            color: var(--bg);
        }

        .btn-ghost {
            background: transparent;
            color: var(--fg-secondary);
        }
        .btn-ghost:hover { background: var(--surface); color: var(--fg-primary); }

        /* --- 底部抽屉 (列表) --- */
        .drawer-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s var(--ease);
        }
        .drawer-overlay.active { opacity: 1; pointer-events: auto; }

        .drawer {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: var(--bg);
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.4s var(--ease);
            z-index: 11;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
            max-height: 70vh;
            overflow-y: auto;
        }
        .drawer.active { transform: translateY(0); }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .drawer-title { font-size: 18px; font-weight: 700; }
        .drawer-close { background: var(--surface); border: none; width: 32px; height: 32px; border-radius: 50%; color: var(--fg-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center;}

        /* 列表项 */
        .node-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        .node-item:last-child { border-bottom: none; }
        
        .node-info h4 { margin: 0; font-size: 15px; color: var(--fg-primary); }
        .node-info p { margin: 4px 0 0; font-size: 12px; color: var(--fg-secondary); }
        
        .node-stat { font-family: "SF Mono", monospace; font-size: 13px; font-weight: 500; }
        .stat-good { color: #10b981; }
        .stat-fair { color: #f59e0b; }
        .stat-poor { color: #ef4444; }

        /* --- 动画关键帧 --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* 页脚 */
        .footer {
            position: fixed;
            bottom: 24px;
            font-size: 12px;
            color: var(--fg-secondary);
            opacity: 0.5;
            z-index: 1;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- 品牌 -->
        <div class="brand">
            <img src="https://img.cdn1.vip/i/6921348cd5a96_1763783820.webp" alt="Logo" class="logo-img">
            <span class="brand-text">iozz Network</span>
        </div>

        <!-- 倒计时 (视觉中心) -->
        <div class="hero-section">
            <div class="timer-display" id="countdown">5</div>
            <div class="progress-bar-container">
                <div class="progress-fill" id="progress-bar"></div>
            </div>
        </div>

        <!-- 目标信息 -->
        <div class="status-box">
            <div class="status-label">即将跳转至</div>
            <div class="target-name">
                <span class="pulse-dot loading" id="status-dot"></span>
                <span id="target-text">正在优选节点...</span>
            </div>
        </div>

        <!-- 按钮 -->
        <div class="actions">
            <button id="btn-skip" class="btn btn-primary">立即跳转</button>
            <button id="btn-list" class="btn btn-ghost">选择其他线路</button>
        </div>
    </div>

    <!-- 底部版权 -->
    <div class="footer">
        &copy; 2024 iozz. All Systems Operational.
    </div>

    <!-- 抽屉菜单 -->
    <div class="drawer-overlay" id="overlay"></div>
    <div class="drawer" id="drawer">
        <div class="drawer-header">
            <div class="drawer-title">可用节点</div>
            <button class="drawer-close" id="close-drawer">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div id="node-list"></div>
    </div>

    <script>
        const CONFIG = {
            autoTime: 5,
            timeout: 2000,
            nodes: [
                { id: 'EdgeOne', name: 'EdgeOne', url: 'https://edgeone.iozz.cc/', tag: 'HK Premium', w: 90 },
                { id: 'cloudflare', name: 'Cloudflare', url: 'https://cf.iozz.cc/', tag: 'Global Anycast', w: 90 },
                { id: 'asia', name: 'Asia CDN', url: 'https://cdn.iozz.cc/', tag: 'Direct Line', w: 90 },
                { id: 'claw', name: 'Claw Cloud', url: 'https://claw.iozz.cc/', tag: 'Optimized', w: 90 }
            ]
        };

        const state = {
            best: null,
            time: CONFIG.autoTime,
            timer: null,
            isPaused: false
        };

        const el = {
            countdown: document.getElementById('countdown'),
            progress: document.getElementById('progress-bar'),
            targetText: document.getElementById('target-text'),
            statusDot: document.getElementById('status-dot'),
            btnSkip: document.getElementById('btn-skip'),
            btnList: document.getElementById('btn-list'),
            drawer: document.getElementById('drawer'),
            overlay: document.getElementById('overlay'),
            closeDrawer: document.getElementById('close-drawer'),
            nodeList: document.getElementById('node-list')
        };

        // --- 核心逻辑 ---
        async function init() {
            startTimer();
            // 并发测速
            await Promise.all(CONFIG.nodes.map(ping));
            selectBest();
            renderList();
        }

        function ping(node) {
            const start = Date.now();
            const ctrl = new AbortController();
            setTimeout(() => ctrl.abort(), CONFIG.timeout);
            const target = `${node.url}${node.url.includes('?') ? '&' : '?'}t=${Date.now()}`;

            return fetch(target, { method: 'HEAD', mode: 'no-cors', signal: ctrl.signal, cache: 'no-store' })
                .then(() => {
                    node.latency = Date.now() - start;
                    node.online = true;
                })
                .catch(() => {
                    node.latency = 9999;
                    node.online = false;
                });
        }

        function selectBest() {
            const online = CONFIG.nodes.filter(n => n.online).sort((a,b) => a.latency - b.latency);
            
            if (online.length > 0) {
                state.best = online[0];
                updateTargetUI(state.best);
                
                // 预加载
                const link = document.createElement('link');
                link.rel = 'prefetch';
                link.href = state.best.url;
                document.head.appendChild(link);
            } else {
                handleError();
            }
        }

        function updateTargetUI(node) {
            el.targetText.textContent = node.name;
            el.statusDot.className = 'pulse-dot'; // remove loading
            el.statusDot.style.background = '#10b981';
            
            // 简单的文字切换动画
            el.targetText.style.opacity = 0;
            requestAnimationFrame(() => {
                el.targetText.style.transition = 'opacity 0.3s';
                el.targetText.style.opacity = 1;
            });
        }

        function handleError() {
            el.targetText.textContent = "无可用节点";
            el.statusDot.className = 'pulse-dot error';
            clearInterval(state.timer);
            el.btnSkip.disabled = true;
            el.btnSkip.style.opacity = 0.5;
            el.btnSkip.textContent = "连接失败";
        }

        function startTimer() {
            el.countdown.textContent = state.time;
            
            state.timer = setInterval(() => {
                if(state.isPaused) return;

                state.time--;
                el.countdown.textContent = state.time;
                
                // 进度条缩减
                const percent = (state.time / CONFIG.autoTime);
                el.progress.style.transform = `scaleX(${percent})`;

                if (state.time <= 0) {
                    clearInterval(state.timer);
                    if (state.best) redirect(state.best);
                }
            }, 1000);
        }

        function redirect(node) {
            el.btnSkip.innerHTML = `<span style="animation:spin 1s infinite linear">↻</span> 跳转中...`;
            window.location.href = node.url;
        }

        // --- 交互与抽屉 ---
        function toggleDrawer(show) {
            state.isPaused = show; // 打开菜单时暂停计时
            if (show) {
                el.drawer.classList.add('active');
                el.overlay.classList.add('active');
            } else {
                el.drawer.classList.remove('active');
                el.overlay.classList.remove('active');
            }
        }

        function renderList() {
            el.nodeList.innerHTML = CONFIG.nodes.map(n => {
                let statClass = 'stat-good';
                if(n.latency > 200) statClass = 'stat-fair';
                if(!n.online || n.latency > 900) statClass = 'stat-poor';
                const latText = n.online ? `${n.latency}ms` : 'Down';
                
                return `
                <div class="node-item" onclick="selectNode('${n.id}')">
                    <div class="node-info">
                        <h4>${n.name}</h4>
                        <p>${n.tag}</p>
                    </div>
                    <div class="node-stat ${statClass}">${latText}</div>
                </div>
                `;
            }).join('');
        }

        window.selectNode = (id) => {
            const node = CONFIG.nodes.find(n => n.id === id);
            if(node) {
                redirect(node);
            }
        };

        // 事件绑定
        el.btnSkip.addEventListener('click', () => state.best && redirect(state.best));
        el.btnList.addEventListener('click', () => toggleDrawer(true));
        el.closeDrawer.addEventListener('click', () => toggleDrawer(false));
        el.overlay.addEventListener('click', () => toggleDrawer(false));

        // 旋转动画css
        const style = document.createElement('style');
        style.innerHTML = `@keyframes spin { 100% { transform: rotate(360deg); } }`;
        document.head.appendChild(style);

        init();
    </script>
</body>
</html>
